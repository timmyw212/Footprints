<!DOCTYPE html>
<html>
  <head>
    <link href="styles.css" rel="stylesheet">
    <title> Footprints </title>
  </head>
  <body class="bg-image" style="background-image: url('forest.jpeg'); width: 100%; height: 100vh; background-repeat: no-repeat; background-size: cover;">

    <div id="main-info-container">
      <div class="card" id="user-info-card">
        <h1 id="username"> </h1>
      </div>
      <div class="sub-info-container">
        <!-- Distance Traveled Card -->
        <div class="card info">
          <h2>Distance Traveled</h2>
          <span id="distance-traveled-output" class="info-output">sample</span>
        </div>
        <!-- Total Amount of Points -->
        <div class="card info">
          <h2>Total Points</h2>
          <span id="total-points-output" class="info-output"></span>
        </div>
      </div>
    </div>
    
    <div class="card challenges-card">
      <h2 id="challenges-header">Challenges</h2>
      <div class="challenges">
        <div class="challenge">
          <h3 class="challenge-title"> Daily Challenges </h3>
          <div class="task">
            <p class="task-words"> Take the stairs instead of the elevator </p>
            <button class ="completion-button" id="button1" onclick="
            document.getElementById('button1').innerHTML = '&#x2714'
            completedDaily();
          "> Done </button>
          </div>
          <div class="task">
            <p class="task-words"> Take the stairs instead of the elevator </p>
            <button class ="completion-button" id="button2" onclick="
              document.getElementById('button2').innerHTML = '&#x2714'
              completedDaily();
            "> Done </button>
          </div>
          <div class="task">
            <p class="task-words"> Take the stairs instead of the elevator </p>
            <button class ="completion-button" id="button3" onclick="
            document.getElementById('button3').innerHTML = '&#x2714'
            completedDaily();
          "> Done </button>
          </div>
        </div>
        <div class="challenge">
          <h3 class="challenge-title"> Weekly Challenges </h3>
          <div class="task">
            <p class="task-words"> Take the stairs instead of the elevator </p>
            <button class ="completion-button" id="button4" onclick="
            document.getElementById('button4').innerHTML = '&#x2714'
            completedWeekly();
          "> Done </button>
          </div>
          <div class="task">
            <p class="task-words"> Take the stairs instead of the elevator </p>
            <button class ="completion-button" id="button5" onclick="
            document.getElementById('button5').innerHTML = '&#x2714'
            completedWeekly();
          "> Done </button>
          </div>
          <div class="task">
            <p class="task-words"> Take the stairs instead of the elevator </p>
            <button class ="completion-button" id="button6" onclick="
            document.getElementById('button6').innerHTML = '&#x2714'
            completedWeekly();
          "> Done </button>
          </div>
        </div>
        <div class="challenge">

        </div>
      </div>
    </div>
    <script>
      const user = {
        username: sessionStorage.getItem('username'),
        totalPts: 0
      }

      document.getElementById('username').innerHTML = (`Hello, ${user.username}!`);

      if(!localStorage.getItem(user.username)) {
        localStorage.setItem(user.username, 0);
      }
      else {
        totalPts = localStorage.getItem(user.username);
      }

      document.getElementById('total-points-output').innerHTML = (`${user.totalPts}`);

      function calculatePoints(distance, points) {
        totalPoints = distance * 0.000621371 * 100 * points;
        totalPoints = Math.round(distance);
        return points;
      }
      
      function completedDaily() {
        localStorage.setItem(user.username, Number(user.totalPts) + 15);

        user.totalPts= localStorage.getItem(user.username);
        
        document.getElementById('total-points-output').innerHTML = (`${user.totalPts}`);
      }

      function completedWeekly() {
        localStorage.setItem(user.username, Number(user.totalPts) + 100);
        user.totalPts= localStorage.getItem(user.username);

        document.getElementById('total-points-output').innerHTML = (`${user.totalPts}`);
      }

      const fs = required('fs')
      
      fs.readFile('data.json', 'utf8', (err, jsonString) => {
      if (err) {
        console.log("Error reading file:", err);
        return;
      }
      try {
        const data = JSON.parse(jsonString);
        const distance = data.distance;
        const modeOfTransport = data.modeOfTransport;
        user.totalPts = Number(user.totalPts) + calculatePoints(distance, modeOfTransport);
        updateInfo(distance);
      } catch(err) {
          console.log('Error parsing JSON string:', err);
      }
      });

      function updateInfo(distance){
        document.getElementById('total-points-output').innerHTML = (`${user.totalPts}`);

        distance = distance * 0.000621371;

        totalDistance = Number(document.getElementById('distance-distance-traveled-output').value()) + distance;

        document.getElementById('distance-distance-traveled-output').innerHTML = (`${totalDistance}`);
      }
    </script>
</html>